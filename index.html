<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Jeu d'Association IA Drag & Drop</title>
    <style>
        /* Reset & base */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root{
            --violet-1:#667eea; --violet-2:#764ba2; --green-1:#48bb78; --green-2:#38a169; 
            --orange-1:#ed8936; --orange-2:#dd6b20; --teal:#38b2ac; --muted:#666;
            --blue-light: #4299e1;
            --red-trap: #c53030; /* Assombrissement pour la lisibilit√© */
            --yellow-accent: #f6e05e;
            --border-color: #e2e8f0;
            --completed: #e0f2f1;
            --drop-zone-bg: #eef2ff;
        }
        html:focus-within{scroll-behavior:smooth}
        body {
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--violet-1) 0%, var(--violet-2) 100%);
            padding: 20px; min-height: 10vh;
        }
        .container { max-width: 1400px; margin: 0 auto; background: white; border-radius: 20px; padding: 40px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); }
        h1 { color: var(--violet-1); text-align: center; margin-bottom: 15px; font-size: 2.2em; }
        .subtitle { text-align:center; color:#666; margin-bottom: 35px; font-size: 1.1em; }
        
        /* --- Instructions CSS (kept but unused) --- */
        .instructions { background: #f8f9ff; padding: 20px; border-radius: 12px; margin-bottom: 30px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .instructions h3 { color: var(--violet-2); margin-bottom: 15px; font-size: 1.2em; }
        .instructions ol { padding-left: 20px; list-style-type: decimal; }
        .instructions li { margin-bottom: 8px; color: var(--ink); line-height: 1.5; font-size: 0.95em; }
        
        /* --- D&D Source Area --- */
        .source-area { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-bottom: 30px; }
        .source-column { 
            background:#f8f9ff; padding:20px; border-radius:12px; min-height: 200px; 
            display: flex; flex-direction: column; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }
        .source-column h3 { color: var(--ink); margin-bottom: 15px; text-align:center; font-size:1.15em; padding-bottom:10px; border-bottom:2px solid var(--border-color); }
        
        /* Layout pour les cartes: 2 colonnes pour les Pr√©cautions, flex pour les Outils */
        #toolSourceList { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; }
        #precautionSourceList {
            display: grid;
            grid-template-columns: repeat(2, 1fr); 
            gap: 15px; 
            justify-content: flex-start; 
        }

        /* --- Cards --- */
        .card { 
            background:white; padding:12px 15px; border-radius:8px; cursor:grab; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); transition: all .2s ease; 
            font-size: .95em; 
            border: 2px solid transparent;
            /* Default max-width for tools */
            max-width: 180px; 
            text-align: center;
        }
        
        .card:hover{ transform: translateY(-1px); box-shadow: 0 3px 8px rgba(0,0,0,0.2); }
        .card:active { cursor: grabbing; }
        
        /* New styles for description/title within source cards */
        .card .card-title {
            font-weight: 700;
            margin-bottom: 5px;
            font-size: 1em;
            color: var(--ink);
        }
        .card .card-desc {
            font-size: 0.8em;
            line-height: 1.5; 
            color: var(--muted);
            text-align: left;
        }
        
        /* Adjustment for Precaution cards inside the new grid */
        .card.precaution {
             max-width: none; 
             text-align: left;
        }
        
        /* Card Types */
        .card.tool{ border-color: var(--green-1); color: var(--green-2); font-weight: 600; }
        .card.tool .card-title { color: var(--green-2); }
        .card.precaution{ border-color: var(--orange-1); }

        .card.dragging { opacity: 0.5; border: 2px dashed var(--violet-1); }
        .card.hidden { display: none; }
        
        /* --- Task Selection Area (The one the user clicks, not drags) --- */
        .task-area { margin-bottom: 30px; border: 1px solid var(--border-color); border-radius: 12px; padding: 20px; background: #fff; }
        .task-area h3 { color: var(--violet-1); margin-bottom: 15px; font-size: 1.3em; }
        .task-list { display: flex; flex-wrap: wrap; gap: 10px; }
        .card.task { 
            cursor: pointer; 
            border: 2px solid var(--violet-1); 
            color: var(--violet-2);
            font-weight: 700;
        }
        .card.task:hover { background: #f8f9ff; }
        .card.task.selected { background: var(--violet-1); color: white; border-color: var(--violet-2); transform: scale(1.03); }
        .card.task.completed { 
            background-color: var(--completed); 
            color: var(--teal); 
            border-color: var(--teal); 
            pointer-events: none; 
            opacity: 0.7;
            transform: none;
            box-shadow: none;
        }

        /* --- Drop Zone --- */
        .drop-zone-container { 
            display: flex; gap: 20px; margin-bottom: 30px; 
            padding: 20px; background: var(--drop-zone-bg); 
            border-radius: 12px; border: 2px dashed var(--violet-1);
            align-items: stretch;
        }
        .drop-slot {
            flex: 1; min-height: 100px; border: 2px dashed #ccc; 
            border-radius: 8px; background: white; 
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            padding: 10px; position: relative;
            transition: all .2s ease;
        }
        .drop-slot.tool { border-color: var(--green-1); }
        .drop-slot.precaution { border-color: var(--orange-1); }
        .drop-slot.drag-over { border-color: var(--blue-light); background: #ebf8ff; box-shadow: 0 0 10px rgba(66, 153, 225, 0.5); }
        
        .slot-label { 
            position: absolute; top: 5px; left: 10px; 
            font-size: 0.8em; font-weight: 700; color: #999; 
        }
        .drop-slot.filled { border-style: solid; }
        .dropped-card { margin: 0; width: 100%; max-width: none; cursor: default; }

        /* General UI */
        .action-buttons{ display:flex; gap:12px; justify-content:center; margin-top: 4px; margin-bottom: 30px; }
        .btn{ padding: 12px 26px; border:none; border-radius:999px; font-size:1.02em; font-weight:700; cursor:pointer; transition: all .25s ease; box-shadow: 0 4px 15px rgba(0,0,0,.2); }
        .btn-validate{ background: linear-gradient(135deg, var(--green-1) 0%, var(--green-2) 100%); color:white }
        .btn-reset{ background: linear-gradient(135deg, var(--orange-1) 0%, var(--orange-2) 100%); color:white }
        .btn:hover{ transform: translateY(-1px); box-shadow: 0 6px 22px rgba(0,0,0,.25) }

        /* Progress */
        .progress{ height:10px; background:#eef2ff; border-radius:999px; overflow:hidden; margin:10px 0 30px; /* Ajout d'une marge pour l'alignement */ }
        .bar{ height:100%; width:0%; background: linear-gradient(90deg, var(--violet-1), var(--violet-2)); transition: width .3s ease }
        
        /* Custom Modal */
        #customModal{ position:fixed; inset:0; background:rgba(0,0,0,.6); display:none; justify-content:center; align-items:center; z-index:1000; opacity:0; transition:opacity .25s ease }
        #customModal.show{ display:flex; opacity:1 }
        #modalBox{ background:white; padding:26px; border-radius:12px; box-shadow:0 5px 25px rgba(0,0,0,.5); max-width:92%; width:600px; text-align:center; transform: scale(.92); transition: transform .25s ease; text-align: left; }
        #customModal.show #modalBox{ transform: scale(1) }
        #modalBox h4 { text-align: center; }
        #modalBox button { display: block; margin: 20px auto 0; }
        
        @media (max-width: 768px){
            .source-area { grid-template-columns: 1fr; } 
            .drop-zone-container { flex-direction: column; gap: 10px; }
            .container{ padding:24px }
            /* Mobile adjustment for precaution list */
            #precautionSourceList { grid-template-columns: 1fr; }
            #modalBox { width: 95%; max-width: none; }
        }
    </style>
</head>
<body>
    <div class="container" role="application" aria-label="Jeu d'association t√¢ches / outils IA glisser-d√©poser">
        <h1>Jeu d'Association IA Drag & Drop</h1>
        <p class="subtitle">Associez une T√¢che, son Outil principal et une Pr√©cautions essentielle.</p>

        <!-- L'ancienne div .instructions est maintenant retir√©e -->

        <!-- Barre de Progression -->
        <div class="progress"><div class="bar" id="progressBar"></div></div>

        <!-- Zone de s√©lection de la T√¢che (Clique simple) -->
        <div class="task-area">
            <h3>üìù S√©lectionnez une T√¢che</h3>
            <div class="task-list" id="taskList">
                <!-- Les cartes t√¢ches sont cliquables, pas d√©pla√ßables -->
                <div class="card task" data-type="task" data-id="qcm" tabindex="0">Cr√©er un QCM exportable</div>
                <div class="card task" data-type="task" data-id="questions" tabindex="0">G√©n√©rer rapidement des questions pour une √©valuation</div>
                <div class="card task" data-type="task" data-id="versions" tabindex="0">Proposer plusieurs versions d‚Äôun exercice</div>
                <div class="card task" data-type="task" data-id="bilan" tabindex="0">Bilan de r√©vision avec explications</div>
                <div class="card task" data-type="task" data-id="adapter" tabindex="0">Adapter un document dans diff√©rents styles</div>
                <div class="card task" data-type="task" data-id="presentation" tabindex="0">R√©aliser la pr√©sentation d‚Äôun cours (slides, support visuel)</div>
                <div class="card task" data-type="task" data-id="resume" tabindex="0">R√©aliser un r√©sum√© audio/vid√©o d‚Äôun PDF</div>
                <div class="card task" data-type="task" data-id="commentaires" tabindex="0">R√©diger des commentaires individualis√©s</div>
                <div class="card task" data-type="task" data-id="feedbacks" tabindex="0">Produire des feedbacks</div>
                <div class="card task" data-type="task" data-id="progression" tabindex="0">Construire une progression de s√©quence (planification)</div>
                <div class="card task" data-type="task" data-id="recherche" tabindex="0">Recherches d‚Äôinformation document√©es</div>
                <div class="card task" data-type="task" data-id="enigmes" tabindex="0">Cr√©er des √©nigmes p√©dagogiques / escape game</div>
                <div class="card task" data-type="task" data-id="fiche" tabindex="0">Cr√©er une fiche de cours avec images</div>
                <div class="card task" data-type="task" data-id="pages_web" tabindex="0">Cr√©er des pages web</div>
                <div class="card task" data-type="task" data-id="recherche_progression" tabindex="0">Recherches pour construire le contenu d‚Äôun nouveau cours</div>
            </div>
        </div>

        <!-- Zone de D√©p√¥t (Drop Zone) -->
        <div class="drop-zone-container">
            <!-- Emplacement Outil -->
            <div class="drop-slot tool" id="toolSlot" data-type="tool" ondragover="allowDrop(event)" ondrop="drop(event)">
                <span class="slot-label">D√©posez l'Outil ici</span>
            </div>
            <!-- Emplacement Pr√©caution -->
            <div class="drop-slot precaution" id="precautionSlot" data-type="precaution" ondragover="allowDrop(event)" ondrop="drop(event)">
                <span class="slot-label">D√©posez la Pr√©cautions ici</span>
            </div>
        </div>
        
        <!-- Boutons -->
        <div class="action-buttons">
            <button class="btn btn-validate" id="btnValidate">‚úì Valider l'association</button>
            <button class="btn btn-reset" id="btnReset">‚Üª Recommencer l'exercice</button>
        </div>

        <!-- Aire de Jeu (Source des cartes d√©pla√ßables) -->
        <div class="source-area" id="sourceArea">
            
            <!-- Colonne Outils Source -->
            <div class="source-column" aria-labelledby="col-outils-source">
                <h3 id="col-outils-source">ü§ñ Outils IA (Source)</h3>
                <div class="card-list" id="toolSourceList">
                    <!-- Outils sans description pour rester compact -->
                    <div class="card tool" data-type="tool" data-id="quizwizard" draggable="true" ondragstart="drag(event)"><div class="card-title">Quiz Wizard</div></div>
                    <div class="card tool" data-type="tool" data-id="chatgpt_gemini_mistral" draggable="true" ondragstart="drag(event)"><div class="card-title">ChatGPT, Gemini, Claude, Mistral</div></div>
                    <div class="card tool" data-type="tool" data-id="claude" draggable="true" ondragstart="drag(event)"><div class="card-title">Claude</div></div> 
                    <div class="card tool" data-type="tool" data-id="perplexity" draggable="true" ondragstart="drag(event)"><div class="card-title">Perplexity</div></div>
                    <div class="card tool" data-type="tool" data-id="gamma" draggable="true" ondragstart="drag(event)"><div class="card-title">Gamma</div></div> 
                    <div class="card tool" data-type="tool" data-id="notebooklm" draggable="true" ondragstart="drag(event)"><div class="card-title">NotebookLM</div></div>
                    <div class="card tool" data-type="tool" data-id="canva" draggable="true" ondragstart="drag(event)"><div class="card-title">Canva</div></div> 
                </div>
            </div>

            <!-- Colonne Pr√©cautions Source (avec deux cartes par ligne) -->
            <div class="source-column" aria-labelledby="col-precautions-source">
                <h3 id="col-precautions-source">‚ö†Ô∏è Pr√©cautions (Source)</h3>
                <div class="card-list" id="precautionSourceList">
                    <div class="card precaution" data-type="precaution" data-id="verif_fact_pertinence" draggable="true" ondragstart="drag(event)">
                        <div class="card-title">V√©rification factuelle</div>
                        <div class="card-desc">Pertinence et exactitude des questions<br>Intention p√©dagogique (adapter au niveau des √©l√®ves)</div>
                    </div>
                    <div class="card precaution" data-type="precaution" data-id="renseignement_contexte" draggable="true" ondragstart="drag(event)">
                        <div class="card-title">Renseignement du contexte</div>
                        <div class="card-desc">Indiquer niveau, dur√©e<br>Comp√©tences vis√©es</div>
                    </div>
                    <div class="card precaution" data-type="precaution" data-id="intention_pedagogique" draggable="true" ondragstart="drag(event)">
                        <div class="card-title">Intention p√©dagogique</div>
                        <div class="card-desc">√âquilibrer la difficult√©<br>Rester align√© avec le programme</div>
                    </div>
                    <div class="card precaution" data-type="precaution" data-id="verif_fact_esprit_critique" draggable="true" ondragstart="drag(event)">
                        <div class="card-title">V√©rification factuelle et Esprit Critique</div>
                        <div class="card-desc">Surtout en sciences/histoire<br>D√©velopper l'esprit critique (inciter les √©l√®ves √† comparer)</div>
                    </div>
                    <div class="card precaution" data-type="precaution" data-id="intention_pedagogique_ton" draggable="true" ondragstart="drag(event)">
                        <div class="card-title">Intention p√©dagogique (Ton)</div>
                        <div class="card-desc">Le changement de ton doit servir l'apprentissage<br>V√©rification factuelle</div>
                    </div>
                    <div class="card precaution" data-type="precaution" data-id="intention_pedagogique_surcharge" draggable="true" ondragstart="drag(event)">
                        <div class="card-title">Intention p√©dagogique (surcharge)</div>
                        <div class="card-desc">√âviter la surcharge cognitive (Trop d'infos ou de visuels)<br>V√©rification factuelle</div>
                    </div>
                    <div class="card precaution" data-type="precaution" data-id="verif_confidentialite" draggable="true" ondragstart="drag(event)">
                        <div class="card-title">V√©rification factuelle et Confidentialit√©/RGPD</div>
                        <div class="card-desc">Pas de documents internes sensibles<br>V√©rification factuelle</div>
                    </div>
                    <div class="card precaution" data-type="precaution" data-id="confidentialite_feedback" draggable="true" ondragstart="drag(event)">
                        <div class="card-title">Confidentialit√© / RGPD et Feedback</div>
                        <div class="card-desc">Pas de noms d'√©l√®ves<br>Feedback constructif et bienveillant</div>
                    </div>
                    <div class="card precaution" data-type="precaution" data-id="verif_croiser_sources" draggable="true" ondragstart="drag(event)">
                        <div class="card-title">V√©rification factuelle (Croiser les sources)</div>
                        <div class="card-desc">Croiser les sources<br>D√©velopper l'esprit critique</div>
                    </div>
                    <div class="card precaution" data-type="precaution" data-id="intention_biais" draggable="true" ondragstart="drag(event)">
                        <div class="card-title">Intention p√©dagogique et Biais</div>
                        <div class="card-desc">Objectif d'apprentissage clair<br>Identification des biais (√©viter st√©r√©otypes)</div>
                    </div>
                    <div class="card precaution" data-type="precaution" data-id="verif_fact_seule" draggable="true" ondragstart="drag(event)">
                        <div class="card-title">V√©rification factuelle</div>
                        <div class="card-desc">V√©rifier l'exactitude des donn√©es<br>Absence d'hallucinations</div>
                    </div>
                </div>
            </div>

        </div>
        
    </div>

    <!-- Modal pour notifications simples (erreur/confirmation) -->
    <div id="customModal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
        <div id="modalBox">
            <h4 id="modalTitle">Attention !</h4>
            <p id="modalMessage"></p>
            <button class="btn btn-validate" id="btnCloseModal">Compris</button>
        </div>
    </div>

    <script>
        // --- CONSTANTE DE S√âCURIT√â GLOBALE ---
        const SECURITY_REMINDER = " <span style='font-weight:700; color:var(--red-trap);'> (Rappel S√©curit√©/RGPD : Toujours v√©rifier les conditions d'utilisation et √©viter les donn√©es personnelles dans ces outils grand public.)</span>";

        // --- DATA MODEL (Associations 1:1:1 bas√©es exactement sur le tableau fourni) ---
        // La remarque de s√©curit√© est ajout√©e directement dans chaque justification d'outil.
        const correctAssociations1to1 = {
            // T√¢che ID:          { tool: 'Outil ID', precaution: 'Pr√©caution ID', rationale: { tool: 'Raison Outil', precaution: 'Raison Pr√©caution' } }
            qcm:                    { 
                tool: 'quizwizard', 
                precaution: 'verif_fact_pertinence', 
                rationale: { 
                    tool: 'Quiz Wizard est sp√©cialis√© dans la cr√©ation de QCMs directement exportables (LMS, Moodle, etc.), ce qui est son usage principal.' + SECURITY_REMINDER, 
                    precaution: 'La v√©rification de la **pertinence** et de l\'**exactitude** des questions est cruciale pour que l\'outil d\'√©valuation soit valide.' 
                } 
            },
            questions:              { 
                tool: 'chatgpt_gemini_mistral', 
                precaution: 'renseignement_contexte', 
                rationale: { 
                    tool: 'Les LLMs g√©n√©ralistes (GPT, Gemini...) sont les meilleurs pour la g√©n√©ration rapide de contenu √† partir d\'un prompt simple, id√©al pour des questions d\'√©valuation imm√©diates.' + SECURITY_REMINDER, 
                    precaution: 'Sans indiquer le **niveau, la dur√©e et les comp√©tences vis√©es**, les questions g√©n√©r√©es seront trop g√©n√©riques ou inadapt√©es au public cible.' 
                } 
            },
            versions:               { 
                tool: 'chatgpt_gemini_mistral', 
                precaution: 'intention_pedagogique', 
                rationale: { 
                    tool: 'Les LLMs g√©n√©ralistes sont excellents pour paraphraser et r√©√©crire des textes selon des contraintes sp√©cifiques (ex: 3 versions de difficult√© diff√©rente).' + SECURITY_REMINDER, 
                    precaution: 'S\'assurer de l\'**√©quilibrage des difficult√©s** et de l\'**alignement avec le programme** est essentiel pour que l\'exercice reste √©quitable et pertinent.' 
                } 
            }, 
            bilan:                  { 
                tool: 'chatgpt_gemini_mistral', 
                precaution: 'verif_fact_esprit_critique', 
                rationale: { 
                    tool: 'Les LLMs g√©n√©ralistes peuvent synth√©tiser de larges corpus et fournir des explications d√©taill√©es, parfait pour un bilan de r√©vision.' + SECURITY_REMINDER, 
                    precaution: 'Il faut **v√©rifier les faits** et d√©velopper l\'**esprit critique** des √©l√®ves, notamment en sciences/histoire, pour √©viter qu\'ils ne consid√®rent le contenu IA comme parole d\'√©vangile.' 
                } 
            }, 
            adapter:                { 
                tool: 'claude', 
                precaution: 'intention_pedagogique_ton', 
                rationale: { 
                    tool: 'Claude (Anthropic) est souvent consid√©r√© comme plus performant dans la gestion de la longueur et du ton, id√©al pour les exercices stylistiques ou les adaptations didactiques.' + SECURITY_REMINDER, 
                    precaution: 'Le changement de style doit servir un **objectif p√©dagogique** clair et la **v√©rification factuelle** reste indispensable, quel que soit le ton.' 
                } 
            },
            presentation:           { 
                tool: 'gamma', 
                precaution: 'intention_pedagogique_surcharge', 
                rationale: { 
                    tool: 'Gamma est sp√©cifiquement con√ßu pour g√©n√©rer des pr√©sentations (slides) de mani√®re semi-automatique √† partir de texte.' + SECURITY_REMINDER, 
                    precaution: 'Le risque d\'un outil de pr√©sentation est la **surcharge cognitive** (trop de texte, trop d\'images) qui nuit √† l\'apprentissage. La mod√©ration est cl√©.' 
                } 
            },
            resume:                 { 
                tool: 'notebooklm', 
                precaution: 'verif_confidentialite', 
                rationale: { 
                    tool: 'NotebookLM est con√ßu pour analyser de grands documents PDF (sources) et en tirer des synth√®ses, y compris audio/vid√©o (beta), tout en prot√©geant les donn√©es.' + SECURITY_REMINDER, 
                    precaution: 'Lors de l\'analyse de documents longs (surtout internes), la **confidentialit√© et le RGPD** sont primordiaux. Il faut s\'assurer qu\'aucun document sensible ne soit transmis.' 
                } 
            },
            commentaires:           { 
                tool: 'chatgpt_gemini_mistral', 
                precaution: 'confidentialite_feedback', 
                rationale: { 
                    tool: 'Les LLMs g√©n√©ralistes sont tr√®s efficaces pour g√©n√©rer des variations de texte (commentaires) √† partir de notes, en assurant un ton coh√©rent.' + SECURITY_REMINDER, 
                    precaution: 'Il est essentiel de respecter le **RGPD/Confidentialit√©** (pas de noms d\'√©l√®ves) et de veiller √† ce que le feedback g√©n√©r√© soit **constructif et bienveillant**.' 
                } 
            },
            feedbacks:              { 
                tool: 'chatgpt_gemini_mistral', 
                precaution: 'confidentialite_feedback', 
                rationale: { 
                    tool: 'M√™me raison que pour les commentaires: les LLMs g√©n√©ralistes sont parfaits pour la g√©n√©ration de texte vari√© et personnalis√© bas√© sur des crit√®res.' + SECURITY_REMINDER, 
                    precaution: 'Le **RGPD/Confidentialit√©** (pas de noms d\'√©l√®ves) et la qualit√© (**constructif et bienveillant**) du feedback sont les pr√©cautions les plus critiques ici.' 
                } 
            },
            progression:            { 
                tool: 'chatgpt_gemini_mistral', 
                precaution: 'intention_pedagogique', 
                rationale: { 
                    tool: 'Les LLMs g√©n√©ralistes peuvent cr√©er des plans structur√©s (s√©quences) en se basant sur des programmes officiels et des objectifs d\'apprentissage.' + SECURITY_REMINDER, 
                    precaution: 'Toute planification doit veiller √† l\'**√©quilibrage des difficult√©s** des s√©quences et √† l\'**alignement avec le programme** officiel pour garantir la qualit√© de l\'enseignement.' 
                } 
            },
            recherche:              { 
                tool: 'perplexity', 
                precaution: 'verif_croiser_sources', 
                rationale: { 
                    tool: 'Perplexity est un moteur de recherche conversationnel qui **cite ses sources**, ce qui est essentiel pour la documentation factuelle.' + SECURITY_REMINDER, 
                    precaution: 'Le risque d\'une recherche unique est le biais ou l\'hallucination. Il faut **croiser les sources** et d√©velopper l\'**esprit critique** des √©l√®ves.' 
                } 
            },
            enigmes:                { 
                tool: 'claude', 
                precaution: 'intention_biais', 
                rationale: { 
                    tool: 'Claude, souvent lou√© pour ses capacit√©s narratives et sa cr√©ativit√©, est un excellent choix pour g√©n√©rer des sc√©narios d\'√©nigmes ou d\'Escape Games engageants.' + SECURITY_REMINDER, 
                    precaution: 'Les √©nigmes et jeux exigent un **objectif d\'apprentissage clair** et doivent √™tre purg√©s de tout **biais culturel ou st√©r√©otype** involontairement int√©gr√© par l\'IA.' 
                } 
            },
            fiche:                  { 
                tool: 'canva', 
                precaution: 'verif_fact_seule', 
                rationale: { 
                    tool: 'Canva, gr√¢ce √† son assistant IA (Magic Design, Magic Edit, etc.), est l\'outil le plus adapt√© pour cr√©er rapidement un support visuel (fiche) de qualit√© avec des images.' + SECURITY_REMINDER, 
                    precaution: 'Dans une fiche de cours (support d\'autorit√©), la **v√©rification factuelle** seule est primordiale car les √©l√®ves ne remettront pas en cause le contenu du document.' 
                } 
            },
            pages_web:              { 
                tool: 'claude', 
                precaution: 'verif_fact_seule', 
                rationale: { 
                    tool: 'Claude excelle dans la structuration et la g√©n√©ration de code (HTML/CSS), id√©al pour la cr√©ation rapide de pages web p√©dagogiques.' + SECURITY_REMINDER, 
                    precaution: 'Comme pour la fiche, la page web est un support de r√©f√©rence : la **v√©rification factuelle** pour l\'exactitude des donn√©es est l\'unique pr√©caution la plus essentielle.' 
                } 
            }, 
            recherche_progression:  { 
                tool: 'claude', 
                precaution: 'verif_fact_seule', 
                rationale: { 
                    tool: 'Pour construire un nouveau cours (souvent bas√© sur un grand nombre de ressources et d\'objectifs), Claude est privil√©gi√© pour sa capacit√© √† g√©rer de **longues conversations et t√¢ches complexes**.' + SECURITY_REMINDER, 
                    precaution: 'Comme le contenu du cours est nouveau, la **v√©rification factuelle** pour l\'exactitude des donn√©es est l\'unique pr√©caution la plus essentielle.' 
                } 
            }, 
        };
        
        // --- GLOBAL STATE ---
        const ALL_TASK_IDS = Object.keys(correctAssociations1to1);
        let selectedTask = null;
        let droppedTool = null;
        let droppedPrecaution = null;
        let completedCount = 0; // Nombre de validations r√©ussies

        // --- DOM Elements ---
        const elements = {
            taskList: document.getElementById('taskList'),
            toolSlot: document.getElementById('toolSlot'),
            precautionSlot: document.getElementById('precautionSlot'),
            toolSourceList: document.getElementById('toolSourceList'),
            precautionSourceList: document.getElementById('precautionSourceList'),
            btnValidate: document.getElementById('btnValidate'),
            btnReset: document.getElementById('btnReset'),
            progressBar: document.getElementById('progressBar'),
            customModal: document.getElementById('customModal'),
            modalTitle: document.getElementById('modalTitle'),
            modalMessage: document.getElementById('modalMessage'),
            btnCloseModal: document.getElementById('btnCloseModal'),
        };

        // Stocker une r√©f√©rence de toutes les cartes (pour le reset et le titre)
        const allCards = Array.from(document.querySelectorAll('.card')).map(card => {
            let titleText;
            if (card.querySelector('.card-title')) {
                titleText = card.querySelector('.card-title').textContent.trim();
            } else {
                titleText = card.textContent.trim(); // Pour les cartes t√¢ches
            }
            return {
                id: card.dataset.id,
                type: card.dataset.type,
                title: titleText,
                element: card
            };
        });

        /** Fonction utilitaire pour obtenir le titre d'une carte par ID. */
        function getCardTitle(id) {
            return allCards.find(c => c.id === id)?.title || id;
        }

        // --- UTILS ---

        function showModal(title, message, confirmText = 'Compris') {
            elements.modalTitle.textContent = title;
            elements.modalMessage.innerHTML = message; // Utiliser innerHTML pour permettre le **gras** et le style du rappel s√©curit√©
            elements.btnCloseModal.textContent = confirmText; 
            elements.customModal.classList.add('show');
            elements.modalBox.focus(); 
        }

        function closeModal() {
            elements.customModal.classList.remove('show');
        }

        function updateProgress() {
            const progress = (completedCount / ALL_TASK_IDS.length) * 100;
            elements.progressBar.style.width = `${progress}%`;

            if (completedCount === ALL_TASK_IDS.length) {
                showModal('Exercice Termin√© !', 'F√©licitations ! Vous avez valid√© toutes les associations 1:1:1.', 'Parfait');
            }
        }
        
        // --- DRAG & DROP LOGIC ---

        function allowDrop(ev) {
            ev.preventDefault();
            // Ajoute une classe visuelle pour indiquer que c'est une zone de d√©p√¥t valide
            ev.currentTarget.classList.add('drag-over');
        }
        
        function dragLeave(ev) {
            // Retire la classe visuelle quand la carte quitte la zone
            ev.currentTarget.classList.remove('drag-over');
        }

        function drag(ev) {
            // Emp√™che le glisser si aucune t√¢che n'est s√©lectionn√©e
            if (!selectedTask) {
                ev.preventDefault();
                showModal('S√©lection requise', 'Veuillez d\'abord **s√©lectionner une T√¢che enseignante** avant de glisser-d√©poser un outil ou une pr√©caution.');
                return;
            }
            // D√©finit le type et l'ID de la carte gliss√©e
            ev.dataTransfer.setData("card-id", ev.target.dataset.id);
            ev.dataTransfer.setData("card-type", ev.target.dataset.type);
            ev.target.classList.add('dragging');
        }

        function dragEnd(ev) {
            ev.target.classList.remove('dragging');
        }
        

        function drop(ev) {
            ev.preventDefault();
            const slot = ev.currentTarget;
            slot.classList.remove('drag-over');

            const draggedId = ev.dataTransfer.getData("card-id");
            const draggedType = ev.dataTransfer.getData("card-type");
            const slotType = slot.dataset.type;

            // 1. V√©rification du type (Outil dans Outil, Pr√©caution dans Pr√©caution)
            if (draggedType !== slotType) {
                showModal('Erreur de d√©p√¥t', `Vous ne pouvez d√©poser qu'une carte de type "**${slotType === 'tool' ? 'Outil' : 'Pr√©cautions'}**" dans cet emplacement.`);
                return;
            }

            // 2. R√©cup√©rer et remettre l'ancienne carte si l'emplacement √©tait d√©j√† rempli
            let oldCardInSlot = slot.querySelector('.dropped-card');
            if (oldCardInSlot) {
                // On utilise l'ID et le type de la carte d'origine stock√©s dans la data-attributs du clone
                resetDroppedCard(oldCardInSlot.dataset.id, oldCardInSlot.dataset.type); 
                clearSlot(slot); 
            }
            
            // 3. Mettre √† jour l'√©tat et l'affichage de l'emplacement
            const newCardElement = document.querySelector(`.card[data-id="${draggedId}"][data-type="${draggedType}"]`);
            
            // Mettre √† jour l'√©tat global
            if (slotType === 'tool') {
                droppedTool = draggedId;
            } else {
                droppedPrecaution = draggedId;
            }

            // Mettre √† jour l'affichage de la source (carte invisible)
            newCardElement.classList.add('hidden');
            
            // Nettoyer et placer la nouvelle carte dans l'emplacement de d√©p√¥t
            const newCardClone = newCardElement.cloneNode(true);
            
            slot.appendChild(newCardClone);
            newCardClone.classList.remove('hidden');
            newCardClone.classList.add('dropped-card');
            newCardClone.draggable = false; 
            newCardClone.style.maxWidth = '100%'; // S'assurer qu'elle prend toute la place
            
            // Cacher la description pour la compacit√© dans le slot et styler le titre
            if (newCardClone.querySelector('.card-desc')) {
                newCardClone.querySelector('.card-desc').style.display = 'none';
            }
            
            // Styliser l'apparence de la carte dans le slot
            const cardTitleElement = newCardClone.querySelector('.card-title') || newCardClone;

            if (draggedType === 'tool') {
                cardTitleElement.style.color = 'white';
                newCardClone.style.backgroundColor = 'var(--green-1)';
                newCardClone.style.borderColor = 'var(--green-2)';
            } else if (draggedType === 'precaution') {
                cardTitleElement.style.color = 'white';
                newCardClone.style.backgroundColor = 'var(--orange-1)';
                newCardClone.style.borderColor = 'var(--orange-2)';
            }

            slot.classList.add('filled');
            
            // Ajouter le bouton de retrait rapide dans le slot
            const removeBtn = document.createElement('button');
            removeBtn.textContent = 'X';
            removeBtn.style.cssText = 'position:absolute; top:5px; right:5px; background:var(--red-trap); color:white; border:none; border-radius:50%; width:20px; height:20px; font-size:12px; cursor:pointer; z-index:10;';
            removeBtn.onclick = (e) => {
                e.stopPropagation();
                // On utilise les data-attributs du clone pour savoir quelle carte remettre √† la source
                resetDroppedCard(newCardClone.dataset.id, newCardClone.dataset.type); 
                clearSlot(slot);
            };
            slot.appendChild(removeBtn);
        }

        /** R√©initialise visuellement et logiquement une carte de l'emplacement de d√©p√¥t √† la source. */
        function resetDroppedCard(id, type) {
            const originalCard = document.querySelector(`.card[data-id="${id}"][data-type="${type}"]`);
            if (originalCard) {
                originalCard.classList.remove('hidden');
            }
            if (type === 'tool') {
                droppedTool = null;
            } else {
                droppedPrecaution = null;
            }
        }
        
        /** Nettoie visuellement l'emplacement de d√©p√¥t. */
        function clearSlot(slot) {
            const slotType = slot.dataset.type;
            slot.innerHTML = `<span class="slot-label">D√©posez ${slotType === 'tool' ? 'l\'Outil' : 'la Pr√©cautions'} ici</span>`;
            slot.classList.remove('filled');
        }

        // --- TASK SELECTION LOGIC ---

        function selectTask(card) {
            if (card.classList.contains('completed')) return;

            const newTaskId = card.dataset.id;

            // 1. D√©s√©lectionner l'ancienne t√¢che visuellement
            if (selectedTask) {
                document.querySelector(`.card.task[data-id="${selectedTask}"]`)?.classList.remove('selected');
            }

            // 2. Mettre √† jour la s√©lection
            selectedTask = newTaskId;
            card.classList.add('selected');

            // 3. R√©initialiser la zone de d√©p√¥t (les cartes de la source redeviennent visibles)
            resetDropZoneAndSource(false);
        }

        // --- VALIDATION LOGIC ---

        function validateAssociation() {
            if (!selectedTask) {
                showModal('S√©lection incompl√®te', 'Veuillez **s√©lectionner une T√¢che** enseignante.');
                return;
            }
            if (!droppedTool || !droppedPrecaution) {
                showModal('S√©lection incompl√®te', 'Veuillez glisser-d√©poser **un Outil et une Pr√©cautions** dans leurs emplacements.');
                return;
            }

            const expected = correctAssociations1to1[selectedTask];
            
            // 1. Validation 1:1:1
            const isToolCorrect = droppedTool === expected.tool;
            const isPrecautionCorrect = droppedPrecaution === expected.precaution;
            
            if (isToolCorrect && isPrecautionCorrect) {
                // Succ√®s
                
                // 1. Marquer la t√¢che comme compl√©t√©e
                const taskCard = document.querySelector(`.card.task[data-id="${selectedTask}"]`);
                taskCard.classList.add('completed');
                taskCard.classList.remove('selected');

                // 2. Incr√©menter le compteur de succ√®s
                completedCount++;

                // 3. R√©initialiser la zone de d√©p√¥t pour la prochaine t√¢che
                resetDropZoneAndSource(true); // Passer 'true' pour cacher d√©finitivement les cartes utilis√©es

                showModal('Validation r√©ussie !', `L'association pour la t√¢che **${getCardTitle(selectedTask)}** est correcte.`, 'Continuer');

                // 4. R√©initialiser l'√©tat global et l'affichage
                selectedTask = null;
                updateProgress();

            } else {
                // √âchec - Fournir un feedback d√©taill√© et justifi√©
                const taskTitle = getCardTitle(selectedTask);

                let title = 'Association incorrecte';
                let message = `L'association pour la t√¢che **${taskTitle}** est incompl√®te ou incorrecte.`;

                if (!isToolCorrect) {
                    // L'outil est faux
                    const expectedToolTitle = getCardTitle(expected.tool);
                    message += `<br><br>üö® **Outil incorrect :** L'outil principal s√©lectionn√© n'est pas le plus pertinent.`;
                    message += `<br>‚úÖ **Outil attendu :** <span style="font-weight:700; color:var(--green-2);">${expectedToolTitle}</span>.`;
                    message += `<br>‚û°Ô∏è **Justification :** ${expected.rationale.tool}`;
                }

                if (!isPrecautionCorrect) {
                    // La pr√©caution est fausse
                    const expectedPrecautionCard = allCards.find(c => c.id === expected.precaution);
                    const expectedPrecautionTitle = expectedPrecautionCard.title;
                    
                    message += `<br><br>üö® **Pr√©cautions incorrecte :** La pr√©caution choisie n'est pas la plus essentielle.`;
                    message += `<br>‚úÖ **Pr√©cautions attendue :** <span style="font-weight:700; color:var(--orange-2);">${expectedPrecautionTitle}</span>.`;
                    message += `<br>‚û°Ô∏è **Justification :** ${expected.rationale.precaution}`;
                }
                
                showModal(title, message, 'R√©essayer');
                
                // Remettre les cartes dans la source
                resetDropZoneAndSource(false);
            }
        }
        
        /** R√©initialise la zone de d√©p√¥t et g√®re le retour des cartes √† la source. */
        function resetDropZoneAndSource(isFinalValidation = false) {
            
            const resetSlot = (slot) => {
                const cardElement = slot.querySelector('.dropped-card');
                if (cardElement) {
                    const id = cardElement.dataset.id;
                    const type = cardElement.dataset.type;

                    if (!isFinalValidation) {
                        // Si c'est juste un √©chec de validation, on remet la carte √† la source (visible)
                        const originalCard = document.querySelector(`.card[data-id="${id}"][data-type="${type}"]`);
                        if (originalCard) originalCard.classList.remove('hidden');
                    }
                }
                clearSlot(slot);
            };

            // R√©initialiser les slots et les cartes de retour
            resetSlot(elements.toolSlot);
            resetSlot(elements.precautionSlot);

            // R√©initialiser l'√©tat local des cartes gliss√©es
            droppedTool = null;
            droppedPrecaution = null;
            
            // Nettoyer la s√©lection de t√¢che si la validation √©tait r√©ussie
            if (isFinalValidation) {
                document.querySelectorAll('.card.task.selected').forEach(card => card.classList.remove('selected'));
            }
        }
        
        /** R√©initialisation compl√®te de l'exercice. */
        function resetFullExercise() {
            // R√©initialiser l'√©tat global
            selectedTask = null;
            completedCount = 0;
            
            // R√©initialiser les cartes
            document.querySelectorAll('.card').forEach(card => {
                card.classList.remove('selected');
                card.classList.remove('completed');
                card.classList.remove('hidden');
            });
            
            // R√©initialiser la zone de d√©p√¥t et les cartes qui y √©taient
            resetDropZoneAndSource(false);

            // Mettre √† jour l'interface
            updateProgress();
            
        }


        // --- INITIALISATION ---

        window.onload = () => {
            // Configurer les √©couteurs pour les cartes de T√¢che (clic simple)
            elements.taskList.addEventListener('click', (e) => {
                const card = e.target.closest('.card.task');
                if (card) {
                    selectTask(card);
                }
            });

            // Configurer les √©couteurs pour les boutons
            elements.btnValidate.addEventListener('click', validateAssociation);
            elements.btnReset.addEventListener('click', () => {
                showModal('Confirmation', 'Voulez-vous vraiment recommencer l\'exercice et effacer votre progression ?', 'Confirmer la r√©initialisation');
            });

            // Configurer les √©couteurs du Drag & Drop pour les slots
            const slots = [elements.precautionSlot, elements.toolSlot];
            slots.forEach(slot => {
                slot.addEventListener('dragenter', allowDrop);
                slot.addEventListener('dragleave', dragLeave);
                slot.addEventListener('drop', drop);
            });
            

            // Configurer les √©couteurs sur les cartes sources pour la fin du drag
            document.querySelectorAll('.card[draggable="true"]').forEach(card => {
                card.addEventListener('dragend', dragEnd);
            });
            
            // √âcouteur du Modal (pour g√©rer le reset)
            elements.btnCloseModal.addEventListener('click', () => {
                // Si le titre du modal est 'Confirmation', c'est qu'on a cliqu√© sur le bouton de r√©initialisation
                if(elements.modalTitle.textContent === 'Confirmation') {
                    resetFullExercise(); 
                }
                closeModal();
            });
            elements.customModal.addEventListener('click', (e) => {
                // Fermer le modal si on clique en dehors de la bo√Æte
                if (e.target.id === 'customModal') {
                    closeModal();
                }
            });

            // Lancement initial
            resetFullExercise();
        };

    </script>
</body>
</html>
