<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Jeu d'Association IA Drag & Drop</title>
    <style>
        /* Reset & base */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root{
            --violet-1:#667eea; --violet-2:#764ba2; --green-1:#48bb78; --green-2:#38a169; 
            --orange-1:#ed8936; --orange-2:#dd6b20; --teal:#38b2ac; --muted:#666;
            --blue-light: #4299e1;
            --red-trap: #c53030;
            --yellow-accent: #f6e05e;
            --border-color: #e2e8f0;
            --completed: #e0f2f1;
            --drop-zone-bg: #eef2ff;
        }
        html:focus-within{scroll-behavior:smooth}
        body {
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--green-1) 0%, var(--violet-2) 100%);
            padding: 20px; min-height: 100vh;
        }
        .container { max-width: 1400px; margin: 0 auto; background: white; border-radius: 20px; padding: 40px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); }
        h1 { color: var(--green-1); text-align: center; margin-bottom: 15px; font-size: 2.2em; }
        .subtitle { text-align:center; color:#666; margin-bottom: 35px; font-size: 1.1em; }
        
        .source-area { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-bottom: 30px; }
        .source-column { 
            background:#f8f9ff; padding:20px; border-radius:12px; min-height: 200px; 
            display: flex; flex-direction: column; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }
        .source-column h3 { color: #333; margin-bottom: 15px; text-align:center; font-size:1.15em; padding-bottom:10px; border-bottom:2px solid var(--border-color); }
        
        #toolSourceList { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; }
        #precautionSourceList {
            display: grid;
            grid-template-columns: repeat(2, 1fr); 
            gap: 15px; 
            justify-content: flex-start; 
        }

        .card { 
            background:white; padding:12px 15px; border-radius:8px; cursor:grab; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); transition: all .2s ease; 
            font-size: .95em; 
            border: 2px solid transparent;
            max-width: 180px; 
            text-align: center;
        }
        
        .card:hover{ transform: translateY(-1px); box-shadow: 0 3px 8px rgba(0,0,0,0.2); }
        .card:active { cursor: grabbing; }
        
        .card .card-title {
            font-weight: 700;
            margin-bottom: 5px;
            font-size: 1em;
            color: #333;
        }
        .card .card-desc {
            font-size: 0.8em;
            line-height: 1.5; 
            color: var(--muted);
            text-align: left;
        }
        /* Style ajout√© pour la note de cr√©ation de compte */
        .card .card-note {
            font-size: 0.75em;
            font-weight: 600;
            color: var(--violet-2); /* Utiliser une couleur pour l'accent */
            margin-top: 5px;
            line-height: 1.2;
        }
        
        .card.precaution {
             max-width: none; 
             text-align: left;
        }
        
        .card.tool{ border-color: var(--green-1); color: var(--green-2); font-weight: 600; }
        .card.tool .card-title { color: var(--green-2); }
        .card.precaution{ border-color: var(--orange-1); }

        .card.dragging { opacity: 0.5; border: 2px dashed var(--green-1); }
        .card.hidden { display: none; }
        
        .task-area { margin-bottom: 30px; border: 1px solid var(--border-color); border-radius: 12px; padding: 20px; background: #fff; }
        .task-area h3 { color: var(--green-1); margin-bottom: 15px; font-size: 1.3em; }
        .task-list { display: flex; flex-wrap: wrap; gap: 10px; }
        .card.task { 
            cursor: pointer; 
            border: 2px solid var(--green-1); 
            color: var(--violet-2);
            font-weight: 700;
        }
        .card.task:hover { background: #f8f9ff; }
        .card.task.selected { background: var(--green-1); color: white; border-color: var(--violet-2); transform: scale(1.03); }
        .card.task.completed { 
            background-color: var(--completed); 
            color: var(--teal); 
            border-color: var(--teal); 
            pointer-events: none; 
            opacity: 0.7;
            transform: none;
            box-shadow: none;
        }

        .drop-zone-container { 
            display: flex; gap: 20px; margin-bottom: 30px; 
            padding: 20px; background: var(--drop-zone-bg); 
            border-radius: 12px; border: 2px dashed var(--green-1);
            align-items: stretch;
        }
        .drop-slot {
            flex: 1; min-height: 100px; border: 2px dashed #ccc; 
            border-radius: 8px; background: white; 
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            padding: 10px; position: relative;
            transition: all .2s ease;
        }
        .drop-slot.tool { border-color: var(--green-1); }
        .drop-slot.precaution { border-color: var(--orange-1); }
        .drop-slot.drag-over { border-color: var(--blue-light); background: #ebf8ff; box-shadow: 0 0 10px rgba(66, 153, 225, 0.5); }
        
        .slot-label { 
            position: absolute; top: 5px; left: 10px; 
            font-size: 0.8em; font-weight: 700; color: #999; 
        }
        .drop-slot.filled { border-style: solid; }
        .dropped-card { margin: 0; width: 100%; max-width: none; cursor: default; }

        .action-buttons{ display:flex; gap:12px; justify-content:center; margin-top: 4px; margin-bottom: 30px; }
        .btn{ padding: 12px 26px; border:none; border-radius:999px; font-size:1.02em; font-weight:700; cursor:pointer; transition: all .25s ease; box-shadow: 0 4px 15px rgba(0,0,0,.2); }
        .btn-validate{ background: linear-gradient(135deg, var(--green-1) 0%, var(--green-2) 100%); color:white }
        .btn-reset{ background: linear-gradient(135deg, var(--orange-1) 0%, var(--orange-2) 100%); color:white }
        .btn:hover{ transform: translateY(-1px); box-shadow: 0 6px 22px rgba(0,0,0,.25) }

        .progress{ height:10px; background:#eef2ff; border-radius:999px; overflow:hidden; margin:10px 0 30px; }
        .bar{ height:100%; width:0%; background: linear-gradient(90deg, var(--green-1), var(--violet-2)); transition: width .3s ease }
        
        #customModal{ position:fixed; inset:0; background:rgba(0,0,0,.6); display:none; justify-content:center; align-items:center; z-index:1000; opacity:0; transition:opacity .25s ease }
        #customModal.show{ display:flex; opacity:1 }
        #modalBox{ background:white; padding:26px; border-radius:12px; box-shadow:0 5px 25px rgba(0,0,0,.5); max-width:92%; width:600px; text-align:center; transform: scale(.92); transition: transform .25s ease; text-align: left; }
        #customModal.show #modalBox{ transform: scale(1) }
        #modalBox h4 { text-align: center; }
        #modalBox button { display: block; margin: 20px auto 0; }
        
        @media (max-width: 768px){
            .source-area { grid-template-columns: 1fr; } 
            .drop-zone-container { flex-direction: column; gap: 10px; }
            .container{ padding:24px }
            #precautionSourceList { grid-template-columns: 1fr; }
            #modalBox { width: 95%; max-width: none; }
        }
    </style>
</head>
<body>
    <div class="container" role="application" aria-label="Jeu d'association t√¢ches / outils IA glisser-d√©poser">
        <h1>Intelligence Artificielle et applications p√©dagogiques.</h1>
        <p class="subtitle">Associez une t√¢che √† l'outil le plus adapt√© et √† une pr√©caution essentielle.</p>

        <div class="progress"><div class="bar" id="progressBar"></div></div>

        <div class="task-area">
            <h3>üìù S√©lectionnez une T√¢che</h3>
            <div class="task-list" id="taskList">
                <div class="card task" data-type="task" data-id="qcm" tabindex="0">Cr√©er un QCM exportable</div>
                <div class="card task" data-type="task" data-id="questions" tabindex="0">G√©n√©rer rapidement des questions pour une √©valuation</div>
                <div class="card task" data-type="task" data-id="versions" tabindex="0">Proposer plusieurs versions d'un exercice</div>
                <div class="card task" data-type="task" data-id="bilan" tabindex="0">Bilan de r√©vision avec explications</div>
                <div class="card task" data-type="task" data-id="adapter" tabindex="0">Adapter un document dans diff√©rents styles</div>
                <div class="card task" data-type="task" data-id="presentation" tabindex="0">R√©aliser la pr√©sentation d'un cours (slides, support visuel)</div>
                <div class="card task" data-type="task" data-id="resume" tabindex="0">R√©aliser un r√©sum√© audio/vid√©o d'un PDF</div>
                <div class="card task" data-type="task" data-id="commentaires" tabindex="0">R√©diger des commentaires individualis√©s</div>
                <div class="card task" data-type="task" data-id="feedbacks" tabindex="0">Produire des feedbacks</div>
                <div class="card task" data-type="task" data-id="progression" tabindex="0">Construire une progression de s√©quence (planification)</div>
                <div class="card task" data-type="task" data-id="recherche" tabindex="0">Recherches d'information document√©es</div>
                <div class="card task" data-type="task" data-id="enigmes" tabindex="0">Cr√©er des √©nigmes p√©dagogiques / escape game</div>
                <div class="card task" data-type="task" data-id="fiche" tabindex="0">Cr√©er une fiche de cours avec images</div>
                <div class="card task" data-type="task" data-id="pages_web" tabindex="0">Cr√©er des pages web</div>
                <div class="card task" data-type="task" data-id="recherche_progression" tabindex="0">Recherches pour construire le contenu d'un nouveau cours</div>
            </div>
        </div>

        <div class="drop-zone-container">
            <div class="drop-slot tool" id="toolSlot" data-type="tool" ondragover="allowDrop(event)" ondrop="drop(event)" ondragleave="dragLeave(event)" ondragenter="dragEnter(event)">
                <span class="slot-label">D√©posez l'Outil ici</span>
            </div>
            <div class="drop-slot precaution" id="precautionSlot" data-type="precaution" ondragover="allowDrop(event)" ondrop="drop(event)" ondragleave="dragLeave(event)" ondragenter="dragEnter(event)">
                <span class="slot-label">D√©posez la Pr√©cautions ici</span>
            </div>
        </div>
        
        <div class="action-buttons">
            <button class="btn btn-validate" id="btnValidate" disabled>‚úì Valider l'association</button>
            <button class="btn btn-reset" id="btnReset">‚Üª Recommencer l'exercice</button>
        </div>

        <div class="source-area" id="sourceArea">
            
            <div class="source-column" aria-labelledby="col-outils-source">
                <h3 id="col-outils-source">ü§ñ Outils IA </h3>
                <div class="card-list" id="toolSourceList">
                    <div class="card tool" data-type="tool" data-id="quizwizard" draggable="true" ondragstart="drag(event)">
                        <div class="card-title">Quiz Wizard</div>
                        <div class="card-note">Cr√©ation de compte</div>
                    </div>
                    <div class="card tool" data-type="tool" data-id="chatgpt_gemini_mistral" draggable="true" ondragstart="drag(event)">
                        <div class="card-title">ChatGPT, Gemini, Claude, Mistral</div>
                        <div class="card-note">Cr√©ation de compte</div>
                    </div>
                    <div class="card tool" data-type="tool" data-id="claude" draggable="true" ondragstart="drag(event)">
                        <div class="card-title">Claude</div>
                        <div class="card-note">Cr√©ation de compte</div>
                    </div> 
                    <div class="card tool" data-type="tool" data-id="perplexity" draggable="true" ondragstart="drag(event)">
                        <div class="card-title">Perplexity</div>
                    </div>
                    <div class="card tool" data-type="tool" data-id="gamma" draggable="true" ondragstart="drag(event)">
                        <div class="card-title">Gamma</div>
                        <div class="card-note">Cr√©ation de compte</div>
                    </div> 
                    <div class="card tool" data-type="tool" data-id="notebooklm" draggable="true" ondragstart="drag(event)">
                        <div class="card-title">NotebookLM</div>
                        <div class="card-note">Cr√©ation de compte</div>
                    </div>
                    <div class="card tool" data-type="tool" data-id="canva" draggable="true" ondragstart="drag(event)">
                        <div class="card-title">Canva</div>
                        <div class="card-note">Cr√©ation de compte</div>
                    </div> 
                </div>
            </div>

            <div class="source-column" aria-labelledby="col-precautions-source">
                <h3 id="col-precautions-source">‚ö†Ô∏è Pr√©cautions </h3>
                <div class="card-list" id="precautionSourceList">
                    <div class="card precaution" data-type="precaution" data-id="verif_fact_pertinence" draggable="true" ondragstart="drag(event)">
                        <div class="card-title">V√©rification factuelle</div>
                        <div class="card-desc">Pertinence et exactitude des questions<br>Intention p√©dagogique (adapter au niveau des √©l√®ves)</div>
                    </div>
                    <div class="card precaution" data-type="precaution" data-id="renseignement_contexte" draggable="true" ondragstart="drag(event)">
                        <div class="card-title">Renseignement du contexte</div>
                        <div class="card-desc">Indiquer niveau, dur√©e<br>Comp√©tences vis√©es</div>
                    </div>
                    <div class="card precaution" data-type="precaution" data-id="intention_pedagogique" draggable="true" ondragstart="drag(event)">
                        <div class="card-title">Intention p√©dagogique</div>
                        <div class="card-desc">√âquilibrer la difficult√©<br>Rester align√© avec le programme</div>
                    </div>
                    <div class="card precaution" data-type="precaution" data-id="verif_fact_esprit_critique" draggable="true" ondragstart="drag(event)">
                        <div class="card-title">V√©rification factuelle et Esprit Critique</div>
                        <div class="card-desc">Surtout en sciences/histoire<br>D√©velopper l'esprit critique (inciter les √©l√®ves √† comparer)</div>
                    </div>
                    <div class="card precaution" data-type="precaution" data-id="intention_pedagogique_ton" draggable="true" ondragstart="drag(event)">
                        <div class="card-title">Intention p√©dagogique (Ton)</div>
                        <div class="card-desc">Le changement de ton doit servir l'apprentissage<br>V√©rification factuelle</div>
                    </div>
                    <div class="card precaution" data-type="precaution" data-id="intention_pedagogique_surcharge" draggable="true" ondragstart="drag(event)">
                        <div class="card-title">Intention p√©dagogique (surcharge)</div>
                        <div class="card-desc">√âviter la surcharge cognitive (Trop d'infos ou de visuels)<br>V√©rification factuelle</div>
                    </div>
                    <div class="card precaution" data-type="precaution" data-id="verif_confidentialite" draggable="true" ondragstart="drag(event)">
                        <div class="card-title">V√©rification factuelle et Confidentialit√©/RGPD</div>
                        <div class="card-desc">Pas de documents internes sensibles<br>V√©rification factuelle</div>
                    </div>
                    <div class="card precaution" data-type="precaution" data-id="confidentialite_feedback" draggable="true" ondragstart="drag(event)">
                        <div class="card-title">Confidentialit√© / RGPD et Feedback</div>
                        <div class="card-desc">Pas de noms d'√©l√®ves<br>Feedback constructif et bienveillant</div>
                    </div>
                    <div class="card precaution" data-type="precaution" data-id="verif_croiser_sources" draggable="true" ondragstart="drag(event)">
                        <div class="card-title">V√©rification factuelle (Croiser les sources)</div>
                        <div class="card-desc">Croiser les sources<br>D√©velopper l'esprit critique</div>
                    </div>
                    <div class="card precaution" data-type="precaution" data-id="intention_biais" draggable="true" ondragstart="drag(event)">
                        <div class="card-title">Intention p√©dagogique et Biais</div>
                        <div class="card-desc">Objectif d'apprentissage clair<br>Identification des biais (√©viter st√©r√©otypes)</div>
                    </div>
                    <div class="card precaution" data-type="precaution" data-id="verif_fact_seule" draggable="true" ondragstart="drag(event)">
                        <div class="card-title">V√©rification factuelle</div>
                        <div class="card-desc">V√©rifier l'exactitude des donn√©es<br>Absence d'hallucinations</div>
                    </div>
                </div>
            </div>

        </div>
        
    </div>

    <div id="customModal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
        <div id="modalBox">
            <h4 id="modalTitle">Attention !</h4>
            <p id="modalMessage"></p>
            <button class="btn btn-validate" id="btnCloseModal">Compris</button>
        </div>
    </div>

    <script>
        const SECURITY_REMINDER = " <span style='font-weight:700; color:var(--red-trap);'> (Rappel S√©curit√©/RGPD : Toujours v√©rifier les conditions d'utilisation et √©viter les donn√©es personnelles dans ces outils grand public.)</span>";

        // --- Donn√©es d'Association (Compl√©t√©es) ---
        const correctAssociations1to1 = {
            qcm: { 
                tool: 'quizwizard', 
                precaution: 'verif_fact_pertinence', 
                rationale: { 
                    tool: 'Quiz Wizard est sp√©cialis√© dans la cr√©ation de QCMs directement exportables (LMS, Moodle, etc.), ce qui est son usage principal.' + SECURITY_REMINDER, 
                    precaution: 'La v√©rification de la **pertinence** et de l\'**exactitude** des questions est cruciale pour que l\'outil d\'√©valuation soit valide.' 
                } 
            },
            questions: { 
                tool: 'chatgpt_gemini_mistral', 
                precaution: 'renseignement_contexte', 
                rationale: { 
                    tool: 'Les LLMs g√©n√©ralistes (GPT, Gemini...) sont les meilleurs pour la g√©n√©ration rapide de contenu √† partir d\'un prompt simple, id√©al pour des questions d\'√©valuation imm√©diates.' + SECURITY_REMINDER, 
                    precaution: 'Sans indiquer le **niveau, la dur√©e et les comp√©tences vis√©es**, les questions g√©n√©r√©es seront trop g√©n√©riques ou inadapt√©es au public cible.' 
                } 
            },
            versions: { 
                tool: 'chatgpt_gemini_mistral', 
                precaution: 'intention_pedagogique', 
                rationale: { 
                    tool: 'Les LLMs g√©n√©ralistes sont excellents pour paraphraser et r√©√©crire des textes selon des contraintes sp√©cifiques (ex: 3 versions de difficult√© diff√©rente).' + SECURITY_REMINDER, 
                    precaution: 'S\'assurer de l\'**√©quilibrage des difficult√©s** et de l\'**alignement avec le programme** est essentiel pour que l\'exercice reste √©quitable et pertinent.' 
                } 
            }, 
            bilan: { 
                tool: 'chatgpt_gemini_mistral', 
                precaution: 'verif_fact_esprit_critique', 
                rationale: { 
                    tool: 'Les LLMs g√©n√©ralistes peuvent synth√©tiser de larges corpus et fournir des explications d√©taill√©es, parfait pour un bilan de r√©vision.' + SECURITY_REMINDER, 
                    precaution: 'Il faut **v√©rifier les faits** et d√©velopper l\'**esprit critique** des √©l√®ves, notamment en sciences/histoire, pour √©viter qu\'ils ne consid√®rent le contenu IA comme parole d\'√©vangile.' 
                } 
            }, 
            adapter: { 
                tool: 'claude', 
                precaution: 'intention_pedagogique_ton', 
                rationale: { 
                    tool: 'Claude (Anthropic) est souvent consid√©r√© comme plus performant dans la gestion de la longueur et du ton, id√©al pour les exercices stylistiques ou les adaptations didactiques.' + SECURITY_REMINDER, 
                    precaution: 'Le changement de style doit servir un **objectif p√©dagogique** clair et la **v√©rification factuelle** reste indispensable, quel que soit le ton.' 
                } 
            },
            presentation: { 
                tool: 'gamma', 
                precaution: 'intention_pedagogique_surcharge', 
                rationale: { 
                    tool: 'Gamma est sp√©cifiquement con√ßu pour g√©n√©rer des pr√©sentations (slides) de mani√®re semi-automatique √† partir de texte.' + SECURITY_REMINDER, 
                    precaution: 'Le risque d\'un outil de pr√©sentation est la **surcharge cognitive** (trop de texte, trop d\'images) qui nuit √† l\'apprentissage. La mod√©ration est cl√©.' 
                } 
            },
            resume: { 
                tool: 'notebooklm', 
                precaution: 'verif_confidentialite', 
                rationale: { 
                    tool: 'NotebookLM est con√ßu pour analyser de grands documents PDF (sources) et en tirer des synth√®ses, y compris audio/vid√©o (beta), tout en prot√©geant les donn√©es.' + SECURITY_REMINDER, 
                    precaution: 'Lors de l\'analyse de documents longs (surtout internes), la **confidentialit√© et le RGPD** sont primordiaux. Il faut s\'assurer qu\'aucun document sensible ne soit transmis.' 
                } 
            },
            commentaires: { 
                tool: 'chatgpt_gemini_mistral', 
                precaution: 'confidentialite_feedback', 
                rationale: { 
                    tool: 'Les LLMs g√©n√©ralistes sont tr√®s efficaces pour g√©n√©rer des variations de texte (commentaires) √† partir de notes, en assurant un ton coh√©rent.' + SECURITY_REMINDER, 
                    precaution: 'Il est essentiel de respecter le **RGPD/Confidentialit√©** (pas de noms d\'√©l√®ves) et de veiller √† ce que le feedback g√©n√©r√© soit **constructif et bienveillant**.' 
                } 
            },
            feedbacks: { 
                tool: 'chatgpt_gemini_mistral', 
                precaution: 'confidentialite_feedback', 
                rationale: { 
                    tool: 'M√™me raison que pour les commentaires: les LLMs g√©n√©ralistes sont parfaits pour la g√©n√©ration de texte vari√© et personnalis√© bas√© sur des crit√®res.' + SECURITY_REMINDER, 
                    precaution: 'Le **RGPD/Confidentialit√©** (pas de noms d\'√©l√®ves) et la qualit√© (**constructif et bienveillant**) du feedback sont les pr√©cautions les plus critiques ici.' 
                } 
            },
            progression: { 
                tool: 'chatgpt_gemini_mistral', 
                precaution: 'intention_pedagogique', 
                rationale: { 
                    tool: 'Les LLMs g√©n√©ralistes peuvent cr√©er des plans structur√©s (s√©quences) en se basant sur des programmes officiels et des objectifs d\'apprentissage.' + SECURITY_REMINDER, 
                    precaution: 'Toute planification doit veiller √† l\'**√©quilibrage des difficult√©s** des s√©quences et √† l\'**alignement avec le programme** officiel pour garantir la qualit√© de l\'enseignement.' 
                } 
            },
            recherche: { 
                tool: 'perplexity', 
                precaution: 'verif_croiser_sources', 
                rationale: { 
                    tool: 'Perplexity est un moteur de recherche conversationnel qui **cite ses sources**, ce qui est essentiel pour la documentation factuelle.' + SECURITY_REMINDER, 
                    precaution: 'Le risque d\'une recherche unique est le biais ou l\'hallucination. Il faut **croiser les sources** et d√©velopper l\'**esprit critique** des √©l√®ves.' 
                } 
            },
            enigmes: { 
                tool: 'claude', 
                precaution: 'intention_biais', 
                rationale: { 
                    tool: 'Claude, souvent lou√© pour ses capacit√©s narratives et sa cr√©ativit√©, est un excellent choix pour g√©n√©rer des sc√©narios d\'√©nigmes ou d\'Escape Games engageants.' + SECURITY_REMINDER, 
                    precaution: 'Les √©nigmes et jeux exigent un **objectif d\'apprentissage clair** et doivent √™tre purg√©s de tout **biais culturel ou st√©r√©otype** involontairement int√©gr√© par l\'IA.' 
                } 
            },
            fiche: { 
                tool: 'canva', 
                precaution: 'verif_fact_seule', 
                rationale: { 
                    tool: 'Canva, gr√¢ce √† son assistant IA (Magic Design, Magic Edit, etc.), est l\'outil le plus adapt√© pour cr√©er rapidement un support visuel (fiche) de qualit√© avec des images.' + SECURITY_REMINDER, 
                    precaution: 'Dans une fiche de cours (support d\'autorit√©), la **v√©rification factuelle** seule est primordiale car les √©l√®ves ne remettront pas en cause le contenu du document.' 
                } 
            },
            pages_web: { 
                tool: 'claude', 
                precaution: 'verif_fact_seule', 
                rationale: { 
                    tool: 'Claude excelle dans la structuration et la g√©n√©ration de code (HTML/CSS), id√©al pour la cr√©ation rapide de pages web p√©dagogiques.' + SECURITY_REMINDER, 
                    precaution: 'Comme pour la fiche, la page web est un support de r√©f√©rence : la **v√©rification factuelle** pour l\'exactitude des donn√©es est l\'unique pr√©caution la plus essentielle.' 
                } 
            }, 
            recherche_progression: { 
                tool: 'claude', 
                precaution: 'verif_fact_seule', 
                rationale: { 
                    tool: 'Pour construire un nouveau cours (souvent bas√© sur un grand nombre de ressources et d\'objectifs), Claude est privil√©gi√© pour sa capacit√© √† g√©rer de **longues conversations et t√¢ches complexes**.' + SECURITY_REMINDER, 
                    precaution: 'Comme le contenu du cours est nouveau, la **v√©rification factuelle** pour l\'exactitude des donn√©es est l\'unique pr√©caution la plus essentielle.' 
                } 
            }
        };

        // --- Variables d'√©tat ---
        let selectedTask = null;
        let droppedToolId = null;
        let droppedPrecautionId = null;
        let completedTasks = new Set();
        const totalTasks = Object.keys(correctAssociations1to1).length;

        // --- √âl√©ments du DOM ---
        const taskList = document.getElementById('taskList');
        const toolSlot = document.getElementById('toolSlot');
        const precautionSlot = document.getElementById('precautionSlot');
        const btnValidate = document.getElementById('btnValidate');
        const btnReset = document.getElementById('btnReset');
        const progressBar = document.getElementById('progressBar');
        const customModal = document.getElementById('customModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalMessage = document.getElementById('modalMessage');
        const btnCloseModal = document.getElementById('btnCloseModal');

        // --- Fonctions utilitaires ---

        function updateProgress() {
            const percentage = (completedTasks.size / totalTasks) * 100;
            progressBar.style.width = `${percentage}%`;
            if (completedTasks.size === totalTasks) {
                showModal('üéâ F√©licitations !', 'Vous avez r√©ussi √† associer correctement toutes les t√¢ches, outils et pr√©cautions. Vous √™tes pr√™t(e) √† int√©grer l\'IA dans votre p√©dagogie !', true);
            }
        }

        function showModal(title, message, isSuccess = false) {
            modalTitle.textContent = title;
            modalMessage.innerHTML = message;
            
            modalTitle.style.color = isSuccess ? 'var(--green-1)' : 'var(--red-trap)';
            btnCloseModal.className = isSuccess ? 'btn btn-validate' : 'btn btn-reset';

            customModal.classList.add('show');
            document.getElementById('modalBox').focus();
        }

        function closeModal() {
            customModal.classList.remove('show');
        }
        
        // --- Gestion des Slots (Zone de D√©p√¥t) ---

        function resetDropZones() {
            toolSlot.innerHTML = `<span class="slot-label">D√©posez l'Outil ici</span>`;
            toolSlot.classList.remove('filled');
            toolSlot.removeAttribute('data-id');
            droppedToolId = null;

            precautionSlot.innerHTML = `<span class="slot-label">D√©posez la Pr√©cautions ici</span>`;
            precautionSlot.classList.remove('filled');
            precautionSlot.removeAttribute('data-id');
            droppedPrecautionId = null;

            // Rendre visibles toutes les cartes sources
            document.querySelectorAll('.card.hidden').forEach(card => card.classList.remove('hidden'));

            btnValidate.disabled = true;
        }

        function updateValidationButton() {
             btnValidate.disabled = !(selectedTask && droppedToolId && droppedPrecautionId);
        }

        function placeCardInSlot(slotElement, cardElement) {
            // Vider l'ancien contenu du slot
            slotElement.innerHTML = '';
            
            // Cloner et styliser la carte
            const clone = cardElement.cloneNode(true);
            clone.classList.remove('dragging', 'hidden');
            clone.classList.add('dropped-card');
            clone.draggable = false;
            
            // Attacher au slot
            slotElement.appendChild(clone);
            slotElement.classList.add('filled');
            slotElement.setAttribute('data-id', cardElement.dataset.id);

            // Mettre √† jour l'√©tat
            const type = slotElement.dataset.type;
            if (type === 'tool') {
                droppedToolId = cardElement.dataset.id;
            } else if (type === 'precaution') {
                droppedPrecautionId = cardElement.dataset.id;
            }

            // Cacher la carte originale (source)
            cardElement.classList.add('hidden');

            updateValidationButton();
        }

        // --- Fonctions de Drag & Drop ---

        function drag(event) {
            if (!selectedTask) {
                event.preventDefault();
                showModal('S√©lection requise', 'Veuillez d\'abord **s√©lectionner une T√¢che** dans la liste avant de glisser-d√©poser un outil ou une pr√©caution.');
                return;
            }
            // D√©finir les donn√©es transf√©r√©es : ID de la carte et type
            event.dataTransfer.setData("text/plain", event.target.dataset.id);
            event.dataTransfer.setData("text/type", event.target.dataset.type);
            event.target.classList.add('dragging');

            // Cacher la carte originale dans le slot si elle existe
            const sourceId = event.target.dataset.id;
            let currentSlot = null;
            if (event.target.dataset.type === 'tool' && toolSlot.getAttribute('data-id') === sourceId) {
                currentSlot = toolSlot;
            } else if (event.target.dataset.type === 'precaution' && precautionSlot.getAttribute('data-id') === sourceId) {
                currentSlot = precautionSlot;
            }
            if (currentSlot) {
                currentSlot.innerHTML = `<span class="slot-label">D√©posez ${currentSlot.dataset.type === 'tool' ? 'l\'Outil' : 'la Pr√©cautions'} ici</span>`;
                currentSlot.classList.remove('filled');
                currentSlot.removeAttribute('data-id');
            }
        }

        window.drag = drag; // Exposer √† l'HTML

        function allowDrop(event) {
            event.preventDefault(); // Autorise le drop
        }
        
        window.allowDrop = allowDrop; // Exposer √† l'HTML

        function dragEnter(event) {
            event.preventDefault();
            const type = event.dataTransfer.getData("text/type") || event.target.dataset.type;
            if (event.target.classList.contains('drop-slot') && event.target.dataset.type === type) {
                event.target.classList.add('drag-over');
            }
        }

        window.dragEnter = dragEnter; // Exposer √† l'HTML

        function dragLeave(event) {
            if (event.target.classList.contains('drop-slot')) {
                event.target.classList.remove('drag-over');
            }
        }

        window.dragLeave = dragLeave; // Exposer √† l'HTML

        function drop(event) {
            event.preventDefault();
            const droppedId = event.dataTransfer.getData("text/plain");
            const droppedType = event.dataTransfer.getData("text/type");
            const dropTarget = event.target.closest('.drop-slot');
            const sourceCard = document.querySelector(`.card[data-id="${droppedId}"][data-type="${droppedType}"]`);

            if (!dropTarget || dropTarget.dataset.type !== droppedType || !sourceCard) {
                showModal('Erreur de d√©p√¥t', 'Veuillez d√©poser l\'√©l√©ment dans la zone de d√©p√¥t correspondante (Outil dans Outil, Pr√©caution dans Pr√©caution).');
                sourceCard.classList.remove('dragging');
                return;
            }

            // R√©initialiser l'ancien √©tat si une carte est d√©j√† dans le slot
            if (dropTarget.classList.contains('filled')) {
                const oldCardId = dropTarget.getAttribute('data-id');
                const oldCard = document.querySelector(`.card[data-id="${oldCardId}"][data-type="${droppedType}"]`);
                if (oldCard) {
                    oldCard.classList.remove('hidden');
                }
            }

            placeCardInSlot(dropTarget, sourceCard);
            sourceCard.classList.remove('dragging');
            dropTarget.classList.remove('drag-over');
        }
        
        window.drop = drop; // Exposer √† l'HTML

        // --- Gestion de la T√¢che (S√©lection) ---

        function selectTask(taskElement) {
            // Si la t√¢che est d√©j√† compl√©t√©e, on ignore
            if (taskElement.classList.contains('completed')) return;

            // D√©s√©lectionner la t√¢che pr√©c√©dente
            document.querySelectorAll('.card.task.selected').forEach(card => card.classList.remove('selected'));
            
            // S√©lectionner la nouvelle t√¢che
            taskElement.classList.add('selected');
            selectedTask = taskElement.dataset.id;

            // R√©initialiser les zones de d√©p√¥t pour la nouvelle association
            resetDropZones();
        }

        // --- Gestionnaire d'√âv√©nements ---

        function initEventListeners() {
            // 1. S√©lection de t√¢che
            document.querySelectorAll('.card.task').forEach(task => {
                task.addEventListener('click', () => selectTask(task));
                task.addEventListener('keyup', (event) => {
                    if (event.key === 'Enter' || event.key === ' ') {
                        selectTask(task);
                    }
                });
            });

            // 2. Validation
            btnValidate.addEventListener('click', validateAssociation);

            // 3. R√©initialisation
            btnReset.addEventListener('click', resetGame);

            // 4. Fermeture de la modale
            btnCloseModal.addEventListener('click', closeModal);
            customModal.addEventListener('click', (e) => {
                if (e.target === customModal) {
                    closeModal();
                }
            });
            window.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && customModal.classList.contains('show')) {
                    closeModal();
                }
            });
            
            // 5. Gestionnaire de fin de glissement pour r√©initialiser la classe "dragging"
            document.querySelectorAll('.card[draggable="true"]').forEach(card => {
                card.addEventListener('dragend', (event) => {
                    event.target.classList.remove('dragging');
                    document.querySelectorAll('.drop-slot').forEach(slot => slot.classList.remove('drag-over'));
                });
            });
        }

        // --- Logique de Jeu ---

        function validateAssociation() {
            if (!selectedTask || !droppedToolId || !droppedPrecautionId) {
                showModal('Erreur', 'Veuillez s√©lectionner une T√¢che et d√©poser un Outil et une Pr√©cautions.');
                return;
            }

            const correct = correctAssociations1to1[selectedTask];
            const isToolCorrect = droppedToolId === correct.tool;
            const isPrecautionCorrect = droppedPrecautionId === correct.precaution;
            
            let feedbackTitle = '';
            let feedbackMessage = '<h3>Association incorrecte ! Voici les √©l√©ments √† revoir :</h3>';

            if (isToolCorrect && isPrecautionCorrect) {
                // Succ√®s
                feedbackTitle = '‚úÖ Association Correcte !';
                feedbackMessage = `
                    <h3>T√¢che r√©ussie !</h3>
                    <p><strong>Outil :</strong> ${correct.rationale.tool}</p>
                    <p><strong>Pr√©cautions :</strong> ${correct.rationale.precaution}</p>
                `;
                
                // Mettre √† jour l'√©tat
                completedTasks.add(selectedTask);
                document.querySelector(`.card.task[data-id="${selectedTask}"]`).classList.add('completed');
                
                // R√©initialiser pour le prochain tour
                selectedTask = null;
                document.querySelectorAll('.card.task.selected').forEach(card => card.classList.remove('selected'));
                resetDropZones();

            } else {
                // √âchec
                feedbackTitle = '‚ùå Erreur d\'Association';
                
                if (!isToolCorrect) {
                    const expectedTool = document.querySelector(`.card.tool[data-id="${correct.tool}"] .card-title`).textContent;
                    feedbackMessage += `<p style="margin-top:10px;"><strong>ü§ñ Outil :</strong> L'outil s√©lectionn√© est incorrect. L'outil le plus adapt√© est **${expectedTool}**. <br/>*Raison :* ${correct.rationale.tool}</p>`;
                } else {
                    feedbackMessage += `<p style="margin-top:10px; color:var(--green-2);"><strong>‚úÖ Outil :</strong> Outil correct (${document.querySelector(`.card.tool[data-id="${droppedToolId}"] .card-title`).textContent}).</p>`;
                }

                if (!isPrecautionCorrect) {
                    const expectedPrecaution = document.querySelector(`.card.precaution[data-id="${correct.precaution}"] .card-title`).textContent;
                    feedbackMessage += `<p style="margin-top:10px;"><strong>‚ö†Ô∏è Pr√©cautions :</strong> La pr√©caution s√©lectionn√©e est incorrecte. La pr√©caution essentielle est **${expectedPrecaution}**. <br/>*Raison :* ${correct.rationale.precaution}</p>`;
                } else {
                    feedbackMessage += `<p style="margin-top:10px; color:var(--green-2);"><strong>‚úÖ Pr√©cautions :</strong> Pr√©cautions correctes (${document.querySelector(`.card.precaution[data-id="${droppedPrecautionId}"] .card-title`).textContent}).</p>`;
                }
            }

            showModal(feedbackTitle, feedbackMessage, isToolCorrect && isPrecautionCorrect);
            updateProgress();
            
            // Apr√®s √©chec, on r√©initialise les drop zones
            if (!(isToolCorrect && isPrecautionCorrect)) {
                 resetDropZones();
            }
        }

        function resetGame() {
            completedTasks.clear();
            updateProgress();
            resetDropZones();
            selectedTask = null;
            document.querySelectorAll('.card.task').forEach(card => {
                card.classList.remove('completed', 'selected');
            });
            showModal('Jeu R√©initialis√©', 'L\'exercice a √©t√© compl√®tement r√©initialis√©. Bonne chance pour le recommencer !', true);
        }

        // --- Initialisation ---

        window.onload = initEventListeners;
        // La premi√®re initialisation de la progression n'est pas n√©cessaire car elle est d√©j√† √† 0%
    </script>
</body>
</html>
